<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#000000"/><meta name="description" content="芯片测试报价系统 - 专业的芯片测试服务报价平台"/><link rel="apple-touch-icon" href="/logo192.png"/><link rel="manifest" href="/manifest.json"/><title>芯片测试报价系统</title><script defer="defer" src="/static/js/main.e60b8b09.js"></script><link href="/static/css/main.f08f903d.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div><script>!function(){"serviceWorker"in navigator&&"caches"in window&&caches.keys().then(e=>{e.length>3&&e.slice(3).forEach(e=>caches.delete(e))}),console.log("🔥 认证重定向脚本已加载");const e=window.navigator.userAgent.toLowerCase(),o=new URLSearchParams(window.location.search),t=e.includes("wxwork")||e.includes("micromessenger")||e.includes("wecom")||document.referrer.includes("weixin.qq.com")||document.referrer.includes("work.weixin.qq.com")||"true"===sessionStorage.getItem("wework_authenticated")||"wecom"===o.get("from"),n="true"===o.get("debug")||"true"===o.get("dev")||"localhost"===window.location.hostname||"3000"===window.location.port||"true"===sessionStorage.getItem("debug_mode_enabled"),s=/android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e);if(t&&s){console.log("📱 检测到企业微信移动端环境"),sessionStorage.setItem("wework_mobile","true");const e=document.querySelector('meta[name="viewport"]');e&&(e.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover")}if(n)return console.log("🛠️ 检测到调试模式，跳过认证检查"),console.log("💡 调试模式提示："),console.log("   - 在URL添加 ?debug=true 启用调试模式"),console.log("   - localhost访问自动启用调试模式"),console.log("   - 调试模式下不会自动重定向认证"),void setTimeout(()=>{const e=document.createElement("div");e.style.cssText="\n                    position: fixed; top: 0; left: 0; right: 0; \n                    background: #ff6b35; color: white; padding: 8px; \n                    font-size: 12px; text-align: center; z-index: 9999;\n                    font-family: monospace;\n                ",e.innerHTML="🛠️ 开发调试模式 - 认证已跳过 | 添加 ?debug=false 恢复认证",document.body.appendChild(e)},1e3);if(t&&(console.log("🏢 检测到企业微信环境，执行认证检查"),sessionStorage.setItem("wework_authenticated","true")),window.location.pathname.startsWith("/auth")||window.location.pathname.includes("/test-auth"))return void console.log("已在认证页面，跳过检查");if(s){const e=document.createElement("div");e.id="mobile-loading",e.style.cssText="\n                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n                background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 10000;\n                font-size: 14px; color: #666; text-align: center;\n                font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n            ",e.innerHTML="正在加载芯片测试报价系统...<br><small>请稍候</small>",document.body.appendChild(e),setTimeout(()=>{const e=document.getElementById("mobile-loading");e&&e.remove()},3e4)}console.log("🔐 执行认证状态检查...");const i=parseInt(sessionStorage.getItem("auth_fail_count")||"0");if(i>=3){console.warn("🚫 检测到多次认证失败，启用调试模式");const e=document.getElementById("mobile-loading");return e&&(e.innerHTML="认证服务异常<br><small>已启用调试模式</small>",setTimeout(()=>e.remove(),2e3)),sessionStorage.removeItem("auth_fail_count"),void sessionStorage.setItem("debug_mode_enabled","true")}const a=setTimeout(()=>{console.warn("认证检查超时");const e=i+1;sessionStorage.setItem("auth_fail_count",e.toString()),e>=3?(console.log("多次超时，启用调试模式"),sessionStorage.setItem("debug_mode_enabled","true"),location.reload()):window.location.href="/auth/login"},8e3);fetch("/api/me",{credentials:"include",headers:{"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"}}).then(e=>{if(clearTimeout(a),console.log("认证状态检查:",e.status),401===e.status){const e=i+1;if(console.log(`用户未认证 (${e}/3)`),e>=3)return console.log("多次认证失败，启用调试模式"),sessionStorage.setItem("debug_mode_enabled","true"),sessionStorage.removeItem("auth_fail_count"),void location.reload();sessionStorage.setItem("auth_fail_count",e.toString());const o=t?"/auth/login?from=wecom&mobile="+(s?"1":"0"):"/auth/login";window.location.href=o}else{console.log("用户已认证，继续正常加载"),sessionStorage.removeItem("auth_fail_count");const e=document.getElementById("mobile-loading");e&&e.remove(),t&&sessionStorage.removeItem("wework_auth_attempted")}}).catch(e=>{clearTimeout(a),console.error("认证检查失败:",e);const o=i+1;if(sessionStorage.setItem("auth_fail_count",o.toString()),s){const e=document.getElementById("mobile-loading");if(e){if(o>=3)return e.innerHTML="认证服务异常<br><small>启用调试模式中...</small>",void setTimeout(()=>{sessionStorage.setItem("debug_mode_enabled","true"),sessionStorage.removeItem("auth_fail_count"),location.reload()},2e3);e.innerHTML=`网络连接异常 (${o}/3)<br><small>正在重试...</small>`}}o>=3?(console.log("多次网络错误，启用调试模式"),sessionStorage.setItem("debug_mode_enabled","true"),sessionStorage.removeItem("auth_fail_count"),location.reload()):setTimeout(()=>{const e=t?"/auth/login?from=wecom&mobile="+(s?"1":"0"):"/auth/login";window.location.href=e},3e3)})}()</script></body></html>