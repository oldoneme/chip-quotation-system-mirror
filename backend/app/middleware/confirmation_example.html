<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•æ„Ÿæ“ä½œç¡®è®¤ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .danger-zone {
            background-color: #fff5f5;
            border-color: #fed7d7;
        }
        
        .warning-zone {
            background-color: #fffaf0;
            border-color: #fbb6ce;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: 1px solid;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-danger {
            background-color: #e53e3e;
            border-color: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c53030;
        }
        
        .btn-warning {
            background-color: #ed8936;
            border-color: #ed8936;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #dd6b20;
        }
        
        .btn-info {
            background-color: #3182ce;
            border-color: #3182ce;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #2c5282;
        }
        
        .operation-log {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-left: 3px solid #4a90e2;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry.error {
            border-left-color: #e53e3e;
            background-color: #fff5f5;
        }
        
        .log-entry.success {
            border-left-color: #38a169;
            background-color: #f0fff4;
        }
        
        .pending-confirmations {
            background-color: #ebf8ff;
            border: 1px solid #bee3f8;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .confirmation-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #ed8936;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            margin-left: 10px;
        }
        
        .risk-medium { background-color: #ffd700; color: #000; }
        .risk-high { background-color: #ff6b35; color: #fff; }
        .risk-critical { background-color: #e53e3e; color: #fff; }
        
        h1, h2, h3 {
            color: #2d3748;
        }
        
        p {
            color: #4a5568;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ•æ„Ÿæ“ä½œäºŒæ¬¡ç¡®è®¤ç³»ç»Ÿç¤ºä¾‹</h1>
        <p>æ­¤é¡µé¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ•æ„Ÿæ“ä½œç¡®è®¤ç³»ç»Ÿæ¥ä¿æŠ¤é‡è¦çš„ç³»ç»Ÿæ“ä½œã€‚</p>
        
        <!-- ç”¨æˆ·ç®¡ç†æ•æ„Ÿæ“ä½œ -->
        <div class="section danger-zone">
            <h2>ğŸ”´ ç”¨æˆ·ç®¡ç†æ•æ„Ÿæ“ä½œ</h2>
            <p>ä»¥ä¸‹æ“ä½œå¯èƒ½å¯¹ç”¨æˆ·æ•°æ®é€ æˆä¸å¯é€†çš„å½±å“ï¼š</p>
            
            <button class="btn-danger" onclick="testDeleteUser()">
                åˆ é™¤ç”¨æˆ·
                <span class="risk-badge risk-high">HIGH</span>
            </button>
            
            <button class="btn-danger" onclick="testChangeUserRole()">
                ä¿®æ”¹ç”¨æˆ·è§’è‰²
                <span class="risk-badge risk-high">HIGH</span>
            </button>
            
            <button class="btn-danger" onclick="testBatchDisableUsers()">
                æ‰¹é‡ç¦ç”¨ç”¨æˆ·
                <span class="risk-badge risk-critical">CRITICAL</span>
            </button>
        </div>
        
        <!-- æ•°æ®ç®¡ç†æ•æ„Ÿæ“ä½œ -->
        <div class="section warning-zone">
            <h2>ğŸŸ¡ æ•°æ®ç®¡ç†æ•æ„Ÿæ“ä½œ</h2>
            <p>ä»¥ä¸‹æ“ä½œæ¶‰åŠé‡è¦çš„ä¸šåŠ¡æ•°æ®ï¼š</p>
            
            <button class="btn-warning" onclick="testDeleteQuotation()">
                åˆ é™¤æŠ¥ä»·
                <span class="risk-badge risk-medium">MEDIUM</span>
            </button>
            
            <button class="btn-warning" onclick="testBatchDeleteQuotations()">
                æ‰¹é‡åˆ é™¤æŠ¥ä»·
                <span class="risk-badge risk-high">HIGH</span>
            </button>
            
            <button class="btn-warning" onclick="testExportData()">
                å¯¼å‡ºæ•æ„Ÿæ•°æ®
                <span class="risk-badge risk-medium">MEDIUM</span>
            </button>
        </div>
        
        <!-- ç³»ç»Ÿç®¡ç†æ•æ„Ÿæ“ä½œ -->
        <div class="section danger-zone">
            <h2>ğŸ”´ ç³»ç»Ÿç®¡ç†æ•æ„Ÿæ“ä½œ</h2>
            <p>ä»¥ä¸‹æ“ä½œå¯èƒ½å½±å“æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œï¼š</p>
            
            <button class="btn-danger" onclick="testSystemConfigChange()">
                ä¿®æ”¹ç³»ç»Ÿé…ç½®
                <span class="risk-badge risk-critical">CRITICAL</span>
            </button>
            
            <button class="btn-danger" onclick="testDatabaseCleanup()">
                æ•°æ®åº“æ¸…ç†
                <span class="risk-badge risk-critical">CRITICAL</span>
            </button>
            
            <button class="btn-danger" onclick="testSystemReset()">
                ç³»ç»Ÿé‡ç½®
                <span class="risk-badge risk-critical">CRITICAL</span>
            </button>
        </div>
        
        <!-- å¾…ç¡®è®¤æ“ä½œ -->
        <div class="section">
            <h2>ğŸ“‹ å¾…ç¡®è®¤æ“ä½œ</h2>
            <p>å½“å‰ç”¨æˆ·çš„å¾…ç¡®è®¤æ“ä½œï¼š</p>
            <button class="btn-info" onclick="loadPendingConfirmations()">åˆ·æ–°å¾…ç¡®è®¤æ“ä½œ</button>
            <div class="pending-confirmations" id="pending-confirmations">
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½å¾…ç¡®è®¤æ“ä½œ...</p>
            </div>
        </div>
        
        <!-- ç®¡ç†å‘˜æ‰¹å‡† -->
        <div class="section" id="admin-section" style="display: none;">
            <h2>ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜æ‰¹å‡†</h2>
            <p>éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†çš„æ“ä½œï¼š</p>
            <button class="btn-info" onclick="loadAdminPendingConfirmations()">åˆ·æ–°å¾…æ‰¹å‡†æ“ä½œ</button>
            <div class="pending-confirmations" id="admin-pending-confirmations">
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½å¾…æ‰¹å‡†æ“ä½œ...</p>
            </div>
        </div>
        
        <!-- æ“ä½œæ—¥å¿— -->
        <div class="operation-log" id="operation-log">
            <h3>æ“ä½œæ—¥å¿—</h3>
            <div class="log-entry">
                <strong>[INFO]</strong> é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ...
            </div>
        </div>
    </div>

    <script src="frontend_confirmation.js"></script>
    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·ä¿¡æ¯ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ä»APIè·å–ï¼‰
        const currentUser = {
            id: 1,
            name: 'æµ‹è¯•ç”¨æˆ·',
            role: 'admin' // å¯ä»¥æ”¹ä¸º 'user', 'manager', 'admin', 'super_admin'
        };
        
        // æ˜¾ç¤ºç®¡ç†å‘˜åŠŸèƒ½ï¼ˆå¦‚æœæ˜¯ç®¡ç†å‘˜ï¼‰
        if (currentUser.role === 'admin' || currentUser.role === 'super_admin') {
            document.getElementById('admin-section').style.display = 'block';
        }
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logContainer = document.getElementById('operation-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<strong>[${timestamp}] [${type.toUpperCase()}]</strong> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // æ•æ„Ÿæ“ä½œæµ‹è¯•å‡½æ•°
        
        async function testDeleteUser() {
            const operation = 'user_delete';
            const operationData = {
                user_id: 123,
                reason: 'è¿åç”¨æˆ·åè®®'
            };
            
            log('å¼€å§‹æ‰§è¡Œåˆ é™¤ç”¨æˆ·æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        // æ¨¡æ‹Ÿå®é™…çš„åˆ é™¤æ“ä½œ
                        log('æ­£åœ¨åˆ é™¤ç”¨æˆ·...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        log('ç”¨æˆ·åˆ é™¤æˆåŠŸ', 'success');
                        return { success: true, message: 'ç”¨æˆ·å·²åˆ é™¤' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('åˆ é™¤ç”¨æˆ·æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`åˆ é™¤ç”¨æˆ·æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`åˆ é™¤ç”¨æˆ·æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testChangeUserRole() {
            const operation = 'user_role_change';
            const operationData = {
                user_id: 456,
                new_role: 'admin',
                reason: 'æ™‹å‡ä¸ºç®¡ç†å‘˜'
            };
            
            log('å¼€å§‹æ‰§è¡Œä¿®æ”¹ç”¨æˆ·è§’è‰²æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨ä¿®æ”¹ç”¨æˆ·è§’è‰²...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        log('ç”¨æˆ·è§’è‰²ä¿®æ”¹æˆåŠŸ', 'success');
                        return { success: true, message: 'è§’è‰²å·²ä¿®æ”¹' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('ä¿®æ”¹ç”¨æˆ·è§’è‰²æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`ä¿®æ”¹ç”¨æˆ·è§’è‰²æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`ä¿®æ”¹ç”¨æˆ·è§’è‰²æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testBatchDisableUsers() {
            const operation = 'user_batch_disable';
            const operationData = {
                user_ids: [101, 102, 103],
                reason: 'æ‰¹é‡æ¸…ç†æµ‹è¯•è´¦æˆ·'
            };
            
            log('å¼€å§‹æ‰§è¡Œæ‰¹é‡ç¦ç”¨ç”¨æˆ·æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨æ‰¹é‡ç¦ç”¨ç”¨æˆ·...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        log('ç”¨æˆ·æ‰¹é‡ç¦ç”¨æˆåŠŸ', 'success');
                        return { success: true, message: 'ç”¨æˆ·å·²æ‰¹é‡ç¦ç”¨' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('æ‰¹é‡ç¦ç”¨ç”¨æˆ·æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`æ‰¹é‡ç¦ç”¨ç”¨æˆ·æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`æ‰¹é‡ç¦ç”¨ç”¨æˆ·æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testDeleteQuotation() {
            const operation = 'quotation_delete';
            const operationData = {
                quotation_id: 789,
                reason: 'é‡å¤æŠ¥ä»·'
            };
            
            log('å¼€å§‹æ‰§è¡Œåˆ é™¤æŠ¥ä»·æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨åˆ é™¤æŠ¥ä»·...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 800));
                        log('æŠ¥ä»·åˆ é™¤æˆåŠŸ', 'success');
                        return { success: true, message: 'æŠ¥ä»·å·²åˆ é™¤' };
                    }
                );
                
                log(`åˆ é™¤æŠ¥ä»·æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                
            } catch (error) {
                log(`åˆ é™¤æŠ¥ä»·æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testBatchDeleteQuotations() {
            const operation = 'quotation_batch_delete';
            const operationData = {
                quotation_ids: [201, 202, 203, 204],
                reason: 'æ¸…ç†è¿‡æœŸæŠ¥ä»·'
            };
            
            log('å¼€å§‹æ‰§è¡Œæ‰¹é‡åˆ é™¤æŠ¥ä»·æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨æ‰¹é‡åˆ é™¤æŠ¥ä»·...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 1200));
                        log('æŠ¥ä»·æ‰¹é‡åˆ é™¤æˆåŠŸ', 'success');
                        return { success: true, message: 'æŠ¥ä»·å·²æ‰¹é‡åˆ é™¤' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('æ‰¹é‡åˆ é™¤æŠ¥ä»·æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`æ‰¹é‡åˆ é™¤æŠ¥ä»·æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`æ‰¹é‡åˆ é™¤æŠ¥ä»·æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testExportData() {
            const operation = 'data_export';
            const operationData = {
                export_type: 'user_data',
                date_range: '2024-01-01 to 2024-12-31'
            };
            
            log('å¼€å§‹æ‰§è¡Œæ•°æ®å¯¼å‡ºæ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨å¯¼å‡ºæ•°æ®...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        log('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
                        return { success: true, message: 'æ•°æ®å·²å¯¼å‡º', url: '/downloads/data.xlsx' };
                    }
                );
                
                log(`æ•°æ®å¯¼å‡ºæ“ä½œå®Œæˆ: ${result.message}`, 'success');
                
            } catch (error) {
                log(`æ•°æ®å¯¼å‡ºæ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testSystemConfigChange() {
            const operation = 'system_config_change';
            const operationData = {
                config_key: 'max_login_attempts',
                old_value: '3',
                new_value: '5',
                reason: 'å‡å°‘è¯¯æ“ä½œé”å®š'
            };
            
            log('å¼€å§‹æ‰§è¡Œç³»ç»Ÿé…ç½®ä¿®æ”¹æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨ä¿®æ”¹ç³»ç»Ÿé…ç½®...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        log('ç³»ç»Ÿé…ç½®ä¿®æ”¹æˆåŠŸ', 'success');
                        return { success: true, message: 'é…ç½®å·²ä¿®æ”¹' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('ç³»ç»Ÿé…ç½®ä¿®æ”¹æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`ç³»ç»Ÿé…ç½®ä¿®æ”¹æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`ç³»ç»Ÿé…ç½®ä¿®æ”¹æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testDatabaseCleanup() {
            const operation = 'database_cleanup';
            const operationData = {
                cleanup_type: 'old_logs',
                date_before: '2024-01-01',
                reason: 'æ¸…ç†6ä¸ªæœˆå‰çš„æ—¥å¿—'
            };
            
            log('å¼€å§‹æ‰§è¡Œæ•°æ®åº“æ¸…ç†æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨æ¸…ç†æ•°æ®åº“...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        log('æ•°æ®åº“æ¸…ç†æˆåŠŸ', 'success');
                        return { success: true, message: 'æ•°æ®åº“å·²æ¸…ç†' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('æ•°æ®åº“æ¸…ç†æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`æ•°æ®åº“æ¸…ç†æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`æ•°æ®åº“æ¸…ç†æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testSystemReset() {
            const operation = 'system_reset';
            const operationData = {
                reset_type: 'factory_reset',
                backup_confirmation: 'CONFIRMED',
                reason: 'æµ‹è¯•ç¯å¢ƒé‡ç½®'
            };
            
            log('å¼€å§‹æ‰§è¡Œç³»ç»Ÿé‡ç½®æ“ä½œ...');
            
            try {
                const result = await confirmSensitiveOperation(
                    operation,
                    operationData,
                    async () => {
                        log('æ­£åœ¨é‡ç½®ç³»ç»Ÿ...', 'info');
                        await new Promise(resolve => setTimeout(resolve, 5000));
                        log('ç³»ç»Ÿé‡ç½®æˆåŠŸ', 'success');
                        return { success: true, message: 'ç³»ç»Ÿå·²é‡ç½®' };
                    }
                );
                
                if (result.status === 'pending_admin_approval') {
                    log('ç³»ç»Ÿé‡ç½®æ“ä½œéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†', 'info');
                } else {
                    log(`ç³»ç»Ÿé‡ç½®æ“ä½œå®Œæˆ: ${result.message}`, 'success');
                }
                
            } catch (error) {
                log(`ç³»ç»Ÿé‡ç½®æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // åŠ è½½å¾…ç¡®è®¤æ“ä½œ
        async function loadPendingConfirmations() {
            log('æ­£åœ¨åŠ è½½å¾…ç¡®è®¤æ“ä½œ...');
            
            try {
                const confirmations = await confirmationManager.getPendingConfirmations();
                const container = document.getElementById('pending-confirmations');
                
                if (confirmations.length === 0) {
                    container.innerHTML = '<p>æš‚æ— å¾…ç¡®è®¤æ“ä½œ</p>';
                } else {
                    let html = '';
                    confirmations.forEach(conf => {
                        html += `
                            <div class="confirmation-item">
                                <strong>${conf.operation_name}</strong>
                                <span class="risk-badge risk-${conf.risk_level}">${conf.risk_level}</span>
                                <p>${conf.description}</p>
                                <small>åˆ›å»ºæ—¶é—´: ${new Date(conf.created_at).toLocaleString()}</small>
                                <small> | çŠ¶æ€: ${conf.status}</small>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                }
                
                log(`åŠ è½½äº† ${confirmations.length} ä¸ªå¾…ç¡®è®¤æ“ä½œ`, 'success');
                
            } catch (error) {
                log(`åŠ è½½å¾…ç¡®è®¤æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // åŠ è½½ç®¡ç†å‘˜å¾…æ‰¹å‡†æ“ä½œ
        async function loadAdminPendingConfirmations() {
            log('æ­£åœ¨åŠ è½½å¾…æ‰¹å‡†æ“ä½œ...');
            
            try {
                const confirmations = await confirmationManager.getAdminPendingConfirmations();
                const container = document.getElementById('admin-pending-confirmations');
                
                if (confirmations.length === 0) {
                    container.innerHTML = '<p>æš‚æ— å¾…æ‰¹å‡†æ“ä½œ</p>';
                } else {
                    let html = '';
                    confirmations.forEach(conf => {
                        html += `
                            <div class="confirmation-item">
                                <strong>${conf.operation_name}</strong>
                                <span class="risk-badge risk-${conf.risk_level}">${conf.risk_level}</span>
                                <p>${conf.description}</p>
                                <p><strong>ç”³è¯·ç”¨æˆ·:</strong> ${conf.user_name}</p>
                                <small>åˆ›å»ºæ—¶é—´: ${new Date(conf.created_at).toLocaleString()}</small>
                                <br>
                                <button class="btn-info" onclick="approveOperation('${conf.token}')">æ‰¹å‡†</button>
                                <button class="btn-danger" onclick="rejectOperation('${conf.token}')">æ‹’ç»</button>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                }
                
                log(`åŠ è½½äº† ${confirmations.length} ä¸ªå¾…æ‰¹å‡†æ“ä½œ`, 'success');
                
            } catch (error) {
                log(`åŠ è½½å¾…æ‰¹å‡†æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ‰¹å‡†æ“ä½œ
        async function approveOperation(token) {
            const reason = prompt('è¯·è¾“å…¥æ‰¹å‡†ç†ç”±:');
            if (!reason) return;
            
            log(`æ­£åœ¨æ‰¹å‡†æ“ä½œ ${token}...`);
            
            try {
                const response = await fetch(`/api/v1/confirmations/admin/approve/${token}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        action: 'approve',
                        reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log('æ“ä½œæ‰¹å‡†æˆåŠŸ', 'success');
                    loadAdminPendingConfirmations(); // åˆ·æ–°åˆ—è¡¨
                } else {
                    log(`æ“ä½œæ‰¹å‡†å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                log(`æ“ä½œæ‰¹å‡†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ‹’ç»æ“ä½œ
        async function rejectOperation(token) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»ç†ç”±:');
            if (!reason) return;
            
            log(`æ­£åœ¨æ‹’ç»æ“ä½œ ${token}...`);
            
            try {
                const response = await fetch(`/api/v1/confirmations/admin/approve/${token}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        action: 'reject',
                        reason: reason
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log('æ“ä½œæ‹’ç»æˆåŠŸ', 'success');
                    loadAdminPendingConfirmations(); // åˆ·æ–°åˆ—è¡¨
                } else {
                    log(`æ“ä½œæ‹’ç»å¤±è´¥: ${result.message}`, 'error');
                }
                
            } catch (error) {
                log(`æ“ä½œæ‹’ç»å¤±è´¥: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>