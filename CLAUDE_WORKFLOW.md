# CLAUDE_WORKFLOW.md

**⚠️ 重要：这是Claude Code的强制性工作流程检查清单，每次修改前必须执行**

## 🔒 核心原则（MANDATORY RULES）

### 绝对禁止操作（NEVER DO）

1. **NEVER** 修改 `AuthContext.js` 或任何认证相关文件，除非用户明确要求修复认证问题
2. **NEVER** 在正常用户界面添加调试信息（如 UserDebugInfo, APITestPanel）
3. **NEVER** 一次性修改超过3个核心文件
4. **NEVER** 不备份就进行大修改
5. **NEVER** 修改已工作的认证/核心逻辑

### 强制性检查清单 - 每次修改前必须执行

## Phase 1: 修改前风险评估 (MANDATORY)

□ **我要修改的是核心功能吗？**(认证、路由、数据库连接)
  ❌ 如果是 → 停止，重新评估必要性
  ✅ 如果不是 → 继续

□ **现有功能是否正常工作？**
  ❌ 如果不正常 → 先修复，再添加新功能
  ✅ 如果正常 → 继续，但绝对不能破坏

□ **我这次修改的范围有多大？**
  ❌ 如果涉及>3个文件 → 分解成更小的步骤
  ✅ 如果≤3个文件 → 可以继续

## Phase 2: 修改实施检查 (MANDATORY)

□ **备份检查**
  □ git status 检查当前状态
  □ git stash 或创建备份分支

□ **最小变更原则**
  □ 这次只改一个功能点
  □ 不添加调试信息到正常用户界面
  □ 不修改已工作的认证/核心逻辑

□ **渐进式验证**
  □ 每改一个文件就测试一次
  □ 确认不破坏现有功能

## Phase 3: 完成后验证 (MANDATORY)

□ **功能验证**
  □ 企业微信环境下用户认证是否正常？
  □ 所有原有功能是否还能正常工作？
  □ 新功能是否按预期工作？

□ **代码清洁度**
  □ 没有在正常页面显示调试信息？
  □ 没有添加不必要的依赖？
  □ 代码结构是否清晰？

## 🚨 高风险文件警告

当我准备修改包含以下内容的文件时，自动触发警报：
- **AuthContext.js** → ⚠️ 认证核心文件！极度危险！
- **login, auth, session** → ⚠️ 认证相关！需要额外小心！
- **Navigation.js** → ⚠️ 导航核心！确认不破坏现有菜单！

## 📋 实际操作模板

### 开始任务时

**用户需求**：[描述需求]
**风险评估**：
□ 是否涉及认证？ 是/否
□ 是否涉及核心功能？ 是/否
□ 预计修改文件数：X个
□ 当前系统状态：正常/异常

**如果任何高风险项为"是"，必须重新制定更保守的方案。**

### 每次文件修改前

**要修改的文件**：XXX.js
**修改目的**：[简述]
**风险级别**：低/中/高
**备份状态**：已完成/未完成
**预期影响**：仅新功能/可能影响现有功能

## 🔄 具体实施策略

```javascript
// 我的新工作模式
const workFlow = {
  step1: "检查清单验证",
  step2: "风险评估", 
  step3: "备份现状",
  step4: "最小修改",
  step5: "逐步验证",
  step6: "完整测试"
};

// 绝对禁止的操作
const forbidden = [
  "修改AuthContext.js而不经过严格评估",
  "在正常页面添加调试组件",
  "一次性修改超过3个核心文件",
  "不备份就进行大修改"
];
```

## 🎯 强制执行机制

### 方法1: 自我提醒机制

每次开始编码时，我会先问自己：
*"我现在要修改的是什么？这会影响认证吗？现有功能正常吗？"*

### 方法2: 分步骤强制执行

```javascript
function start_coding_task() {
    if (!run_pre_modification_checks()) {
        return "停止，先完成检查清单";
    }
    
    if (!backup_current_state()) {
        return "停止，先备份当前状态";
    }
    
    return "可以开始编码";
}

function before_each_file_change() {
    ask_user("这个修改会破坏现有功能吗？");
    ask_user("这是最小必要的修改吗？");
}
```

### 方法3: 关键词触发警报

- AuthContext.js → ⚠️ 认证核心文件！极度危险！
- login, auth, session → ⚠️ 认证相关！需要额外小心！
- Navigation.js → ⚠️ 导航核心！确认不破坏现有菜单！

## 🛡️ 让这成为肌肉记忆的方法

1. **制作检查清单卡片**，每次编码前必须过一遍
2. **设定"暂停点"**：修改认证相关代码前强制暂停10秒思考
3. **建立"最小修改"原则**：能用1个文件解决的绝不用2个文件
4. **实施"功能隔离"**：新功能必须在不影响现有功能的前提下添加

## ✅ 标准工作流程

```
开始任务 → 读取CLAUDE_WORKFLOW.md → 执行检查清单 → 才能开始编码
```

**每次工作前，我都会：**

1. ✅ 检查 CLAUDE_WORKFLOW.md
2. ✅ 评估风险等级
3. ✅ 执行相应的安全措施  
4. ✅ 才开始实际编码

---

**🔥 这些规则是MANDATORY的，不是建议！每次修改前必须严格遵循！**