# 统一编辑体验实施计划

## 🎯 业务需求
**目标**: 实现编辑报价单时回到原创建页面，而不是独立的编辑页面
**核心价值**: 统一用户体验，避免界面不一致造成的困惑

## 📊 影响范围分析
- **前端页面**: 6个报价创建页面需要支持编辑模式
- **后端API**: update_quote需要支持内容感知PDF重新生成
- **路由系统**: 删除临时QuoteEdit页面，修改编辑按钮跳转
- **数据流**: 报价单号保持不变，区分新建/编辑逻辑

## 🚦 分阶段实施策略

### Phase 1: 架构设计和第一个类型 (3-5天)
**目标**: 设计通用框架，实现Tooling类型编辑
- [ ] 设计通用编辑模式检测框架
- [ ] 实现Tooling页面编辑模式
- [ ] 后端API支持update_quote
- [ ] PDF重新生成机制

### Phase 2: 核心报价类型 (5-7天)
**目标**: 扩展到主要使用的报价类型
- [ ] InquiryQuote 编辑模式
- [ ] EngineeringQuote 编辑模式
- [ ] 测试和验证核心功能

### Phase 3: 完整功能覆盖 (3-5天)
**目标**: 覆盖所有报价类型
- [ ] 剩余报价类型编辑模式
- [ ] 删除临时QuoteEdit页面
- [ ] 端到端测试

## 🔧 技术方案

### 编辑模式识别
```javascript
// 通过location.state传递编辑标记
const editingState = {
  isEditing: true,
  quoteId: 123,
  quoteNumber: "CIS-KS20250101001"
}

// 或通过URL参数
/tooling-quote?edit=123
```

### API调用区分
```javascript
// 新建模式
QuoteApiService.createQuote(formData)

// 编辑模式
QuoteApiService.updateQuote(quoteId, formData)
```

### 数据转换层
```javascript
// 后端数据 → 前端表单格式
const convertQuoteToFormData = (quote) => {
  // 根据每个页面的formData结构转换
}
```

## 🛡️ 风险控制

### 数据完整性
- [ ] 报价单号绝对不能变更
- [ ] 编辑历史审计跟踪
- [ ] 并发编辑冲突检测

### 用户体验
- [ ] 明确的编辑/新建状态提示
- [ ] 表单预填充完整性验证
- [ ] 错误处理和回滚机制

### 财务准确性
- [ ] PDF重新生成仅在内容变化时触发
- [ ] 所有计算使用Decimal类型
- [ ] 费率变更不影响历史报价

## ✅ 验收标准

### 功能完整性
- [ ] 6个报价类型都支持编辑模式
- [ ] 编辑后报价单号保持不变
- [ ] PDF内容与前端页面完全一致

### 用户体验
- [ ] 编辑界面与创建界面完全一致
- [ ] 表单预填充准确无误
- [ ] 保存后正确返回详情页

### 技术质量
- [ ] 代码复用率高，维护成本低
- [ ] API响应时间<1秒
- [ ] 前端表单验证与后端一致

## 📋 每日检查点

### Day 1-2: 架构设计
- [ ] 完成技术方案设计
- [ ] 创建通用编辑框架
- [ ] 实现第一个类型(Tooling)

### Day 3-4: 核心功能
- [ ] 实现主要报价类型编辑
- [ ] 后端API完整支持
- [ ] PDF重新生成验证

### Day 5-7: 完整验收
- [ ] 所有类型功能完整
- [ ] 端到端测试通过
- [ ] 用户验收测试

---

*此计划遵循CLAUDE.md的渐进式开发哲学和财务系统安全要求*