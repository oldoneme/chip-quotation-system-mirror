# 芯片测试报价系统 (Chip Quotation System)

## 项目概述
这是一个专业的芯片测试报价管理系统，旨在为半导体测试服务商提供高效、准确的报价生成和管理工具。系统支持工程报价和量产报价两种模式，具备多币种支持、灵活的设备配置和智能的价格计算功能。

## 核心功能

### 1. 双模式报价系统
- **工程报价 (Engineering Quote)**
  - 适用于研发和小批量测试
  - 包含工程系数(1.2倍)计算
  - 支持人员费用配置（工程师/技术员）
  - 两步流程：设备选择 → 人员和辅助设备选择

- **量产报价 (Mass Production Quote)**  
  - 适用于大批量生产测试
  - 支持FT(Final Test)和CP(Circuit Probe)两种测试类型
  - 可同时配置多种测试方案
  - 两步流程：机器选择 → 辅助设备选择

### 2. 设备管理体系
- **测试机 (Test Machines)**
  - 支持多品牌型号管理
  - 板卡配置和数量选择
  - 自动计算机时费

- **分选机 (Handlers)**
  - 用于FT测试配置
  - 独立的板卡系统
  
- **探针台 (Probers)**
  - 用于CP测试配置
  - 独立的板卡系统

- **辅助设备 (Auxiliary Equipment)**
  - 分类管理：分选机类、探针台类、其他设备
  - 自动计算辅助设备费用
  - 支持设备类型标识（如AOI、ICT等）

### 3. 多币种支持
- **支持币种**
  - 人民币 (CNY/RMB)
  - 美元 (USD)
  
- **汇率管理**
  - 可自定义汇率设置
  - 自动转换不同币种设备价格
  - 智能处理混合币种计算

### 4. 价格计算逻辑

#### 工程报价计算
```
测试机费用 = Σ(板卡单价 × 汇率 × 折扣率 × 数量) × 工程系数(1.2)
分选机费用 = Σ(板卡单价 × 汇率 × 折扣率 × 数量) × 工程系数(1.2)
探针台费用 = Σ(板卡单价 × 汇率 × 折扣率 × 数量) × 工程系数(1.2)
人员费用 = 固定费率（工程师350元/小时，技术员200元/小时）
辅助设备费用 = Σ(设备小时费率)
```

#### 量产报价计算
```
FT费用 = 测试机板卡费用 + 分选机板卡费用
CP费用 = 测试机板卡费用 + 探针台板卡费用
辅助设备费用 = Σ(设备小时费率)
```

### 5. 用户体验优化
- **状态保持机制**
  - SessionStorage持久化
  - 步骤间无缝切换
  - 从结果页返回保留所有选择

- **智能导航**
  - 上一步/下一步精确定位
  - 从结果页返回到正确步骤
  - 保留所有用户输入

- **清晰的信息展示**
  - 设备信息完整显示（名称、类型、币种、汇率、折扣率）
  - 辅助设备类型标识
  - 实时费用计算和显示

## 技术架构

### 前端技术栈
- **框架**: React 18
- **路由**: React Router v6
- **UI组件**: Ant Design 5.x
- **状态管理**: React Hooks (useState, useEffect)
- **数据持久化**: SessionStorage
- **样式**: CSS + Ant Design Theme

### 后端技术栈
- **框架**: Python Flask
- **数据库**: SQLite
- **ORM**: SQLAlchemy
- **API**: RESTful JSON APIs

### 数据模型
```
Machines (测试机/分选机/探针台)
├── id
├── name
├── supplier_id
├── currency (CNY/USD)
├── exchange_rate
├── discount_rate
└── machine_type_id

CardTypes (板卡类型)
├── id
├── machine_id
├── part_number
├── board_name
├── unit_price
└── quantity

AuxiliaryEquipment (辅助设备)
├── id
├── name
├── type (handler/prober/others)
├── hourly_rate
└── description

Personnel (人员)
├── type (工程师/技术员)
└── hourly_rate
```

## 关键特性

### 1. 智能价格转换
- 自动识别设备原始币种
- 根据报价币种智能转换
- 人员费用固定RMB，需要时转USD

### 2. 灵活的配置选项
- 板卡数量可调
- 支持多选辅助设备
- 测试类型可组合

### 3. 专业的报价输出
- 详细的费用明细
- 设备类型标识清晰
- 币种符号正确显示

### 4. 数据完整性
- 级联删除保护
- 状态一致性保证
- 错误处理机制

## 业务流程

### 工程报价流程
1. 选择测试机及板卡配置
2. 选择分选机及板卡配置（可选）
3. 选择探针台及板卡配置（可选）
4. 选择所需人员类型
5. 选择辅助设备
6. 生成报价结果

### 量产报价流程
1. 选择测试类型（FT/CP）
2. 配置FT：选择测试机、分选机及板卡
3. 配置CP：选择测试机、探针台及板卡
4. 选择辅助设备（分类展示）
5. 生成报价结果

## 最近更新
- 添加多币种支持和汇率管理
- 优化导航逻辑和状态保持
- 完善辅助设备类型显示
- 简化量产报价界面显示
- 统一价格显示格式

## 潜在改进方向
1. **数据管理**
   - 历史报价保存和查询
   - 报价模板功能
   - 批量导入导出

2. **报表功能**
   - PDF报价单生成
   - Excel导出
   - 打印优化

3. **权限管理**
   - 用户登录系统
   - 角色权限控制
   - 审批流程

4. **业务扩展**
   - 客户信息管理
   - 合同关联
   - 成本分析

5. **性能优化**
   - 数据缓存机制
   - 懒加载优化
   - 搜索性能提升

## 项目结构
```
chip-quotation-system/
├── frontend/
│   └── chip-quotation-frontend/
│       ├── src/
│       │   ├── pages/
│       │   │   ├── EngineeringQuote.js    # 工程报价页面
│       │   │   ├── MassProductionQuote.js  # 量产报价页面
│       │   │   └── QuoteResult.js          # 报价结果页面
│       │   ├── components/                 # 公共组件
│       │   ├── services/                   # API服务
│       │   └── utils/                      # 工具函数
│       └── package.json
├── backend/
│   ├── app/
│   │   ├── models.py                       # 数据模型
│   │   ├── routes.py                       # API路由
│   │   └── test.db                         # SQLite数据库
│   └── requirements.txt
└── README.md
```

## 部署说明
- 前端运行端口：3000
- 后端API端口：5000
- 数据库：SQLite（可迁移至PostgreSQL/MySQL）
- 支持环境：Linux/Windows/MacOS

## 总结
该系统是一个功能完整、设计专业的芯片测试报价管理工具，具有良好的用户体验和扩展性。通过模块化设计和清晰的业务逻辑，能够有效提升报价效率和准确性，为半导体测试服务业务提供有力支持。